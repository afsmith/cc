{% extends 'base_template.html' %}
{% load extras i18n static %}

{% block meta_title %}{% trans "Report" %} #{{ this_message.id }}{% endblock %}

{% block content %}

{% if messages %}
    <label for="js_selectMessage">{% trans "Select message:" %}</label>
    <select id="js_selectMessage" style="width: auto;">
        {% for msg in messages %}
        <option value="{{ msg.id }}" {% if msg.id == this_message.id %}selected="selected"{% endif %}>
            {{ msg.subject }} | {{ msg.created_at }} | {{ msg.receivers.all|join:', '|truncatechars:30 }}
        </option>
        {% endfor %}
    </select>
{% endif %}

<div id="report_graph"></div>

<table class="table table-striped">
    <tr class="success">
        <th>{% trans "Sold" %}</th>
        <th>{% trans "Date" %}</th>
        <th>{% trans "Viewed by" %}</th>
        <th>{% trans "Total time" %}</th>
        <th>{% trans "Total visits" %}</th>
        <th>{% trans "Unique IPs" %}</th>
        <th>{% trans "Device types" %}</th>
    </tr>

    {% for row in log_groupby_user %}
    <tr>
        <td><input type="checkbox" name="sold" class="js_sold" id="sold_{{ this_message.id }}_{{ row.tracking_session__participant }}" /></td>
        <td>{{ row.max_date }}</td>
        <td>{{ row.tracking_session__participant__email }}</td>
        <td>{% to_second row.total_time %}</td>
        <td>{{ row.visit_count }}</td>
        <td>{{ row.ip_count }}</td>
        <td>{{ row.device_count }}</td>
    </tr>
    {% endfor %}
</table>
    
{% endblock %}

{% block js_scripts %}
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="{% static 'js/report.js' %}"></script>
{% endblock %}