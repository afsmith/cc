{% extends 'base_template.html' %}
{% load extras i18n staticfiles %}

{% block meta_title %}{% trans "Report" %} #{{ this_message.id }}{% endblock %}

{% block content %}

{% if messages %}
    <label for="js_selectMessage">{% trans "Select message:" %}</label>
    <select id="js_selectMessage" style="width: auto;">
        {% for msg in messages %}
        <option value="{{ msg.id }}" {% if msg.id == this_message.id %}selected="selected"{% endif %}>
            {{ msg.subject }} | {{ msg.created_at }} | {{ msg.receivers.all|join:', '|truncatechars:30 }}
        </option>
        {% endfor %}
    </select>
{% endif %}

{% if log_groupby_user|length == 0 %}

    <p class="alert alert-info">
        {% trans "Looks like no one has viewed your offer yet. Come back again later. Did you know you can receive a notice when they click your link? Next time try the 'Notify when link clicked' checkbox when sending." %}
    </p>

{% else %}

    <div id="report_graph"></div>

    <table class="table report_table">
        <tr class="success">
            <th>{% trans "Sold" %}</th>
            <th>{% trans "Date" %}</th>
            <th>{% trans "Viewed by" %}</th>
            <th>{% trans "Total time" %}</th>
            <th>{% trans "Total visits" %}</th>
            <th>{% trans "Unique IPs" %}</th>
            <th>{% trans "Device types" %}</th>
        </tr>

        {% for row in log_groupby_user %}
        <tr id="row_{{ this_message.id }}_{{ row.tracking_session__participant }}" {% if row.closed_deal %}class="sold"{% endif %}>
            <td><input type="checkbox" name="sold" class="js_sold" {% if row.closed_deal %}checked="checked"{% endif %} /></td>
            <td>{{ row.max_date|date:'d.m.Y H:i:s' }}</td>
            <td class="cell_email">{{ row.tracking_session__participant__email }}</td>
            <td>{{ row.total_time }}</td>
            <td>{{ row.visit_count }}</td>
            <td>{{ row.ip_count }}</td>
            <td>{{ row.device_count }}</td>
        </tr>
        {% endfor %}
    </table>

{% endif %}

{% endblock %}

{% block js_scripts %}
    <script src="{% static 'js/vendor/highcharts.js' %}"></script>
    
    <script src="{% static 'js/report.js' %}"></script>
{% endblock %}