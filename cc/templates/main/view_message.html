{% extends "base_template.html" %}
{% load extras i18n staticfiles %}

{% block meta_title %}{{ message.subject }}{% endblock %}

{% block title %}{{ message.subject }}{% endblock %}

{% block content %}

{% if ocl_expired %}
    <p class="alert">
        {% trans "This link is expired. Please request another link from the sender." %}
    </p>
{% else %}
    <div id="message_viewer" class="flexpaper_viewer"></div>
{% endif %}

{% endblock %}


{% block additional_css %}
    <link rel="stylesheet" href="{% static 'css/vendor/flexpaper.css' %}">
{% endblock %}

{% block js_scripts %}
    <script src="{% static 'js/vendor/flexpaper/jquery.extensions.min.js' %}"></script>
    <script src="{% static 'js/vendor/flexpaper/flexpaper.js' %}"></script>

    <script>
        {% if not ocl_expired and not is_owner_viewing %}
            CC_GLOBAL.message_data = {
                message_id: {{ message.id }},
                user_id: {{ ocl_user.id }},
                page_count: {{ page_count }},
                token: '{{ token }}'
            };
        {% endif %}

        $('#message_viewer').FlexPaperViewer({ 
            config : {
                PDFFile: '{{ original_url }}',
                
                Scale: 0.8,

                ViewModeToolsVisible: true,
                ZoomToolsVisible: true,
                NavToolsVisible: true,
                CursorToolsVisible: true,
                SearchToolsVisible: true,

                jsDirectory: "{% static 'js/vendor/flexpaper/' %}",
                localeDirectory: "{% static 'js/locale/flexpaper/' %}",
                key: "{% settings_value 'FLEXPAPER_KEY' %}"
            }   
        });
    </script>

    <script src="{% static 'js/view_message.js' %}"></script>
{% endblock %}