/* ============================================================
 * bootstrap-tokenfield.js v0.9.5
 * ============================================================
 *
 * Copyright 2013 Sliptree
 * ============================================================ */!function(e){"use strict";var t=function(t,n){var r=this;this.$element=e(t);this.options=e.extend({},e.fn.tokenfield.defaults,{tokens:this.$element.val()},n);var i=this.$element.width();this.$element.css({position:"absolute",left:"-10000px"}).prop("tabindex",-1);this.$wrapper=e('<div class="tokenfield form-control" />');this.$element.hasClass("input-lg")&&this.$wrapper.addClass("input-lg");this.$element.hasClass("input-sm")&&this.$wrapper.addClass("input-sm");this.$input=e('<input type="text" class="token-input" />').appendTo(this.$wrapper).prop("placeholder",this.$element.prop("placeholder"));this.$copyHelper=e('<input type="text" />').css({position:"absolute",left:"-10000px"}).prop("tabindex",-1).prependTo(this.$wrapper);this.$element.parents(".form-inline").length&&this.$wrapper.width(i);this.$element.prop("disabled")&&this.disable();this.$mirror=e('<span style="position:absolute; top:-999px; left:0; white-space:pre;"/>');this.$input.css("min-width",this.options.minWidth+"px");e.each(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(e,t){r.$mirror[0].style[t]=r.$input.css(t)});this.$mirror.appendTo("body");this.$wrapper.insertBefore(this.$element);this.$element.prependTo(this.$wrapper);this.setTokens(this.options.tokens);this.listen();if(this.options.autocomplete.source){var s=e.extend({},this.options.autocomplete,{minLength:this.options.showAutocompleteOnFocus?0:null,position:{my:"left top",at:"left bottom",of:this.$wrapper}});this.$input.autocomplete(s)}};t.prototype={constructor:t,createToken:function(t){typeof t=="string"&&(t={value:t,label:t});var n=this,r=e.trim(t.value),i=t.label.length?e.trim(t.label):r;if(!r.length||!i.length||r.length<this.options.minLength)return;if(!this.options.allowDuplicates&&e.grep(this.getTokens(),function(e){return e.value===r}).length)return;var s=e.Event("beforeCreateToken");s.token={value:r,label:i};this.$element.trigger(s);var o=e('<div class="token" />').attr("data-value",s.token.value).append('<span class="token-label" />').append('<a href="#" class="close" tabindex="-1">&times;</a>');this.$input.before(o);this.$input.css("width",this.options.minWidth+"px");var u=o.find(".token-label"),a=o.find(".close");if(!this.maxTokenWidth){this.maxTokenWidth=this.$wrapper.width()-a.outerWidth()-parseInt(a.css("margin-left"),10)-parseInt(a.css("margin-right"),10)-parseInt(o.css("border-left-width"),10)-parseInt(o.css("border-right-width"),10)-parseInt(o.css("padding-left"),10)-parseInt(o.css("padding-right"),10);parseInt(u.css("border-left-width"),10)-parseInt(u.css("border-right-width"),10)-parseInt(u.css("padding-left"),10)-parseInt(u.css("padding-right"),10);parseInt(u.css("margin-left"),10)-parseInt(u.css("margin-right"),10)}u.text(s.token.label).css("max-width",this.maxTokenWidth);o.on("mousedown",function(e){if(n.disabled)return!1;n.preventDeactivation=!0}).on("click",function(e){if(n.disabled)return!1;n.preventDeactivation=!1;if(e.ctrlKey||e.metaKey){e.preventDefault();return n.toggle(o)}n.activate(o,e.shiftKey,e.shiftKey)}).on("dblclick",function(e){if(n.disabled)return!1;n.edit(o)});a.on("click",e.proxy(this.remove,this));var f=e.Event("afterCreateToken");f.token=s.token;f.relatedTarget=o;this.$element.trigger(f);this.$element.val(this.getTokensList()).trigger("change");this.update();return this.$input.get(0)},setTokens:function(t,n){if(!t)return;n||this.$wrapper.find(".token").remove();typeof t=="string"&&(t=t.split(","));var r=this;e.each(t,function(e,t){r.createToken(t)});return this.$input.get(0)},getTokens:function(t){var n=[],r=t?".active":"";this.$wrapper.find(".token"+r).each(function(){n.push({value:e(this).data("value")||e(this).find(".token-label").text(),label:e(this).find(".token-label").text()})});return n},getTokensList:function(t){return e.map(this.getTokens(t),function(e){return e.value}).join(", ")},getInput:function(){return this.$input.val()},listen:function(){var t=this;this.$wrapper.on("click",e.proxy(this.focusInput,this));this.$input.on("focus",e.proxy(this.focus,this)).on("blur",e.proxy(this.blur,this)).on("paste",e.proxy(this.paste,this)).on("keydown",e.proxy(this.keydown,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this));this.$copyHelper.on("focus",e.proxy(this.focus,this)).on("blur",e.proxy(this.blur,this)).on("keydown",e.proxy(this.keydown,this)).on("keyup",e.proxy(this.keyup,this));this.$input.on("keydown, keypress, keyup",e.proxy(this.update,this));this.$input.on("autocompletecreate",function(){var n=t.$wrapper.width()+parseInt(t.$wrapper.css("padding-right"),10)+parseInt(t.$wrapper.css("border-right-width"),10);e(this).data("uiAutocomplete").menu.element.css("min-width",n+"px")}).on("autocompleteopen",function(){t.$input.data("autocomplete-open",!0)}).on("autocompleteclose",function(){t.$input.data("autocomplete-open",!1)}).on("autocompleteselect",function(e,n){t.$input.val("");t.createToken(n.item);return!1});e(window).on("resize",e.proxy(this.update,this))},keydown:function(t){if(!this.focused)return;switch(t.keyCode){case 8:if(!this.$input.is(":focus"))break;this.lastInputValue=this.$input.val();break;case 37:if(this.$input.is(":focus")){if(this.$input.val().length>0)break;var n=this.$input.prevAll(".token:first");if(!n.length)break;this.preventInputFocus=!0;this.activate(n);t.preventDefault()}else{this.prev(t.shiftKey);t.preventDefault()}break;case 38:if(!t.shiftKey)return;if(this.$input.is(":focus")){if(this.$input.val().length>0)break;var n=this.$input.prev(".token:last");if(!n.length)return;this.activate(n)}var r=this;this.firstActiveToken.nextAll(".token").each(function(){r.deactivate(e(this))});this.activate(this.$wrapper.find(".token:first"),!0,!0);t.preventDefault();break;case 39:if(this.$input.is(":focus")){if(this.$input.val().length>0)break;var i=this.$input.next(".token:first");if(!i.length)break;this.preventInputFocus=!0;this.activate(i);t.preventDefault()}else{this.next(t.shiftKey);t.preventDefault()}break;case 40:if(!t.shiftKey)return;if(this.$input.is(":focus")){if(this.$input.val().length>0)break;var i=this.$input.next(".token:first");if(!i.length)return;this.activate(i)}var r=this;this.firstActiveToken.prevAll(".token").each(function(){r.deactivate(e(this))});this.activate(this.$wrapper.find(".token:last"),!0,!0);t.preventDefault();break;case 65:if(this.$input.val().length>0||!t.ctrlKey&&!t.metaKey)break;this.activateAll();t.preventDefault();break;case 9:case 13:if(this.$input.data("autocomplete-open"))break;(this.$input.is(":focus")&&this.$input.val().length||this.$input.data("edit"))&&this.createTokensFromInput(t);if(t.keyCode===13){if(!this.$element.is(":focus")||this.$wrapper.find(".token.active").length!==1)break;this.edit(this.$wrapper.find(".token.active"))}}this.lastKeyDown=t.keyCode},keypress:function(e){this.lastKeyPressCode=e.keyCode;this.lastKeyPressCharCode=e.charCode},keyup:function(e){this.preventInputFocus=!1;if(!this.focused)return;switch(e.keyCode){case 8:if(this.$input.is(":focus")){if(this.$input.val().length||this.lastInputValue.length&&this.lastKeyDown===8)break;this.activate(this.$input.prevAll(".token:first"))}else this.remove(e);break;case 46:this.remove(e,"next");break;case 188:if(this.lastKeyPressCharCode!==44||!this.$input.is(":focus")||!this.$input.val())break;this.createTokensFromInput(e)}this.lastKeyUp=e.keyCode},focus:function(e){this.focused=!0;this.$wrapper.addClass("focus");if(this.$input.is(":focus")){this.$wrapper.find(".active").removeClass("active");this.firstActiveToken=null;this.options.showAutocompleteOnFocus&&this.$input.data("uiAutocomplete")&&this.search()}},blur:function(e){this.focused=!1;this.$wrapper.removeClass("focus");if(!this.preventDeactivation&&!this.$element.is(":focus")){this.$wrapper.find(".active").removeClass("active");this.firstActiveToken=null}(this.$input.data("edit")&&!this.$input.is(":focus")||this.options.createTokensOnBlur)&&this.createTokensFromInput(e);this.preventDeactivation=!1},paste:function(e){var t=this;setTimeout(function(){t.createTokensFromInput(e)},1)},createTokensFromInput:function(e){if(this.$input.val().length<this.options.minLength)return;var t=this.getTokensList();this.setTokens(this.$input.val(),!0);if(t==this.getTokensList()&&this.$input.val().length)return;this.$input.val("");if(this.$input.data("edit")){this.$input.appendTo(this.$wrapper).data("edit",!1).css("width",this.options.minWidth+"px");if(!this.preventInputFocus){var n=this;setTimeout(function(){n.$input.focus()},1)}this.$wrapper.css("width",this.$wrapper.data("prev-width"))}e.preventDefault();e.stopPropagation()},next:function(e){if(e){var t=this.$wrapper.find(".active:first"),n=t&&this.firstActiveToken?t.index()<this.firstActiveToken.index():!1;if(n)return this.deactivate(t)}var r=this.$wrapper.find(".active:last"),i=r.nextAll(".token:first");if(!i.length){this.$input.focus();return}this.activate(i,e)},prev:function(e){if(e){var t=this.$wrapper.find(".active:last"),n=t&&this.firstActiveToken?t.index()>this.firstActiveToken.index():!1;if(n)return this.deactivate(t)}var r=this.$wrapper.find(".active:first"),i=r.prevAll(".token:first");i.length||(i=this.$wrapper.find(".token:first"));if(!i.length&&!e){this.$input.focus();return}this.activate(i,e)},activate:function(t,n,r,i){if(!t)return;if(this.$wrapper.find(".token.active").length===this.$wrapper.find(".token").length)return;if(typeof i=="undefined")var i=!0;if(r)var n=!0;this.$copyHelper.focus();if(!n){this.$wrapper.find(".active").removeClass("active");i?this.firstActiveToken=t:delete this.firstActiveToken}if(r&&this.firstActiveToken){var s=this.firstActiveToken.index()-2,o=t.index()-2,u=this;this.$wrapper.find(".token").slice(Math.min(s,o)+1,Math.max(s,o)).each(function(){u.activate(e(this),!0)})}t.addClass("active");this.preventDeactivation=!0;this.$copyHelper.val(this.getTokensList(!0)).select()},activateAll:function(){var t=this;this.$wrapper.find(".token").each(function(n){t.activate(e(this),n!==0,!1,!1)})},deactivate:function(e){if(!e)return;e.removeClass("active");this.$copyHelper.val(this.getTokensList(!0)).select()},toggle:function(e){if(!e)return;e.toggleClass("active");this.$copyHelper.val(this.getTokensList(!0)).select()},edit:function(t){if(!t)return;var n=t.data("value"),r=t.find(".token-label").text(),i=e.Event("beforeEditToken");i.token={value:n,label:r};this.$element.trigger(i);t.find(".token-label").text(i.token.value);var s=t.outerWidth();this.$wrapper.data("prev-width",this.$wrapper.width()).width(this.$wrapper.width());t.replaceWith(this.$input);this.$input.val(i.token.value).select().data("edit",!0).width(s)},remove:function(t,n){if(this.$input.is(":focus")||this.disabled)return;var r=t.type==="click"?e(t.target).closest(".token"):this.$wrapper.find(".token.active");if(t.type!=="click"){if(!n)var n="prev";this[n]()}r.remove();this.$element.val(this.getTokensList()).trigger("removeToken").trigger("change");(!this.$wrapper.find(".token").length||t.type==="click")&&this.$input.focus();this.$input.css("width",this.options.minWidth+"px");this.update();t.preventDefault();t.stopPropagation()},update:function(){var e=this.$input.val();if(this.$input.data("edit")){e||(e=this.$input.prop("placeholder"));if(e===this.$mirror.text())return;this.$mirror.text(e);this.$input.width(this.$mirror.width()+10)}else{this.$input.css("width",this.options.minWidth+"px");this.$input.width(this.$wrapper.offset().left+this.$wrapper.width()-this.$input.offset().left+5)}},focusInput:function(t){if(e(t.target).closest(".token").length)return;this.$input.focus()},search:function(){this.$input.autocomplete("search")},disable:function(){this.disabled=!0;this.$input.prop("disabled",!0);this.$wrapper.addClass("disabled")},enable:function(){this.disabled=!1;this.$input.prop("disabled",!1);this.$wrapper.removeClass("disabled")}};var n=e.fn.tokenfield;e.fn.tokenfield=function(n,r){this.each(function(){var i=e(this),s=i.data("bs.tokenfield"),o=typeof n=="object"&&n;if(typeof n=="string"&&s&&s[n])return s[n](r);s||i.data("bs.tokenfield",s=new t(this,o))});return this};e.fn.tokenfield.defaults={minWidth:60,minLength:0,allowDuplicates:!1,autocomplete:{},showAutocompleteOnFocus:!1,createTokensOnBlur:!1};e.fn.tokenfield.Constructor=t;e.fn.tokenfield.noConflict=function(){e.fn.tokenfield=n;return this}}(window.jQuery);